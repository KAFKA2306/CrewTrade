# Telegramの使用法

## Telegramボットの設定

以下では、Telegramボットの作成方法とTelegramユーザーIDの取得方法について説明します。

### 1. Telegramボットの作成

[Telegram BotFather](https://telegram.me/BotFather)とチャットを開始します。

メッセージ`/newbot`を送信します。

*BotFatherの応答：*

> 新しいボットですね。名前は何にしますか？ボットの名前を選択してください。

ボットの公開名を選択します（例：`Freqtrade bot`）。

*BotFatherの応答：*

> 良いですね。では、ボットのユーザー名を選択しましょう。末尾は`bot`でなければなりません。たとえば、TetrisBotやtetris_botのようになります。

ボットの名前IDを選択してBotFatherに送信します（例：`"My_own_freqtrade_bot"`）。

*BotFatherの応答：*

> 完了しました！新しいボットおめでとうございます。`t.me/yourbots_name_bot`で見つかります。ボットの説明、概要セクション、プロフィール写真を追加できます。コマンドのリストについては、/helpを参照してください。ところで、クールなボットの作成が完了したら、より良いユーザー名が必要な場合は、ボットサポートに連絡してください。これを行う前に、ボットが完全に動作していることを確認してください。

> HTTP APIにアクセスするには、このトークンを使用してください：`22222222:APITOKEN`

> ボットAPIの説明については、このページを参照してください：https://core.telegram.org/bots/api Fatherボットがトークン（APIキー）を返します。

APIトークン（上記の例では`22222222:APITOKEN`）をコピーし、設定パラメータ`token`に使用します。

`/START`ボタンをクリックして、ボットとの会話を開始することを忘れないでください。

### 2. TelegramユーザーID

#### ユーザーIDの取得

[userinfobot](https://telegram.me/userinfobot)と話します。

「Id」を取得し、設定パラメータ`chat_id`に使用します。

#### グループIDの使用

グループIDを取得するには、ボットをグループに追加し、freqtradeを開始して、`/tg_info`コマンドを発行します。
これにより、ランダムなボットを使用せずにグループIDが返されます。
「chat_id」はまだ必要ですが、このコマンドではこの特定のグループIDに設定する必要はありません。

応答には、必要に応じて「topic_id」も含まれます。どちらも、設定にコピー/貼り付けできる形式です。
```json
 {
    "enabled": true,
    "token": "********",
    "chat_id": "-1001332619709",
    "topic_id": "122"
}
```
Freqtradeの設定では、完全な値（`-`を含む）を文字列として使用できます。
```json
   "chat_id": "-1001332619709"
```
!!! Warning "Telegramグループの使用"
    Telegramグループを使用する場合、Telegramグループのすべてのメンバーにfreqtradeボットへのアクセスと、Telegram経由で可能なすべてのコマンドへのアクセスを許可することになります。不快な驚きを避けるために、Telegramグループの全員を信頼できることを確認してください。

##### グループトピックID

グループ内の特定のトピックを使用するには、設定で`topic_id`パラメータを使用できます。これにより、グループ内の特定のトピックでボットを使用できます。
これがないと、グループチャットでトピックが有効になっている場合、ボットは常にグループの一般チャネルに応答します。
```json
   "chat_id": "-1001332619709",
   "topic_id": "3"
```
グループIDと同様に、トピック/スレッドから`/tg_info`を使用して正しいトピックIDを取得できます。

#### 承認されたユーザー

グループの場合、ボットにコマンドを送信できるユーザーを制限すると便利な場合があります。

`"authorized_users": []`が存在し、空の場合、どのユーザーもボットを制御できません。
以下の例では、ID「1234567」のユーザーのみがボットを制御でき、他のすべてのユーザーはメッセージを受信することしかできません。
```json
   "chat_id": "-1001332619709",
   "topic_id": "3",
   "authorized_users": ["1234567"]
```
## Telegramのノイズを制御する

Freqtradeは、Telegramボットの冗長性を制御する手段を提供します。
各設定には、次の可能な値があります。

* `on` - メッセージが送信され、ユーザーに通知されます。
* `silent` - メッセージが送信され、通知は音/振動なしになります。
* `off` - メッセージタイプの送信を完全にスキップします。

さまざまな設定を示す構成例：
```json
"telegram": {
    "enabled": true,
    "token": "your_telegram_token",
    "chat_id": "your_telegram_chat_id",
    "allow_custom_messages": true,
    "notification_settings": {
        "status": "silent",
        "warning": "on",
        "startup": "off",
        "entry": "silent",
        "entry_fill": "on",
        "entry_cancel": "silent",
        "exit": {
            "roi": "silent",
            "emergency_exit": "on",
            "force_exit": "on",
            "exit_signal": "silent",
            "trailing_stop_loss": "on",
            "stop_loss": "on",
            "stoploss_on_exchange": "on",
            "custom_exit": "silent",  // custom_exit without specifying an exit reason
            "partial_exit": "on",
            // "custom_exit_message": "silent",  // Disable individual custom exit reasons
            "*": "off"  // Disable all other exit reasons
        },
        // "exit": "off",  // Simplistic configuration to disable all exit messages
        "exit_cancel": "on",
        "exit_fill": "off",
        "protection_trigger": "off",
        "protection_trigger_global": "on",
        "strategy_msg": "off",
        "show_candle": "off"
    },
    "reload": true,
    "balance_dust_level": 0.01
},
```
* `entry`通知は注文が出されたときに送信され、`entry_fill`通知は注文が取引所で約定したときに送信されます。
* `exit`通知は注文が出されたときに送信され、`exit_fill`通知は注文が取引所で約定したときに送信されます。
    終了メッセージ（`exit`および`exit_fill`）は、個々の終了理由レベルでさらに制御でき、特定の終了理由がキーになります。すべての終了理由のデフォルトは`on`ですが、特別な`*`キーを介して構成できます。これは、明示的に定義されていないすべての終了理由のワイルドカードとして機能します。
* `*_fill`通知はデフォルトでオフになっており、明示的に有効にする必要があります。
* `protection_trigger`通知は保護がトリガーされたときに送信され、`protection_trigger_global`通知はグローバル保護がトリガーされたときにトリガーされます。
* `strategy_msg` - 戦略から通知を受信し、戦略から`self.dp.send_msg()`を介して送信されます[詳細](strategy-customization.md#send-notification)。
* `show_candle` - エントリ/終了メッセージの一部としてローソク足の値を表示します。可能な値は`"ohlc"`または`"off"`のみです。
* `balance_dust_level`は、`/balance`コマンドが「ダスト」として認識するものを定義します。これより残高が低い通貨が表示されます。
* `allow_custom_messages`は、戦略メッセージを完全に無効にします。
* `reload`を使用すると、選択したメッセージのリロードボタンを無効にできます。

## カスタムキーボードの作成（コマンドショートカットボタン）

Telegramでは、コマンド用のボタンを備えたカスタムキーボードを作成できます。
デフォルトのカスタムキーボードは次のようになります。
```python
[
    ["/daily", "/profit", "/balance"], # row 1, 3 commands
    ["/status", "/status table", "/performance"], # row 2, 3 commands
    ["/count", "/start", "/stop", "/help"] # row 3, 4 commands
]
```
### 使用法

`config.json`で独自のキーボードを作成できます。
```json
"telegram": {
      "enabled": true,
      "token": "your_telegram_token",
      "chat_id": "your_telegram_chat_id",
      "keyboard": [
          ["/daily", "/stats", "/balance", "/profit"],
          ["/status table", "/performance"],
          ["/reload_config", "/count", "/logs"]
      ]
   },
```
!!! Note "サポートされているコマンド"
    次のコマンドのみが許可されています。コマンド引数はサポートされていません！

    `/start`, `/pause`, `/stop`, `/status`, `/status table`, `/trades`, `/profit`, `/performance`, `/daily`, `/stats`, `/count`, `/locks`, `/balance`, `/stopentry`, `/reload_config`, `/show_config`, `/logs`, `/whitelist`, `/blacklist`, `/help`, `/version`, `/marketdir`

## Telegramコマンド

デフォルトでは、Telegramボットは事前定義されたコマンドを表示します。一部のコマンドは、ボットに送信することによってのみ利用できます。以下の表に、公式コマンドを示します。いつでも`/help`でヘルプを求めることができます。

| コマンド | 説明 |
|----------|-------------|
| **システムコマンド**
| `/start` | トレーダーを開始します
| `/pause | /stopentry | /stopbuy` | トレーダーを一時停止します。ルールに従ってオープントレードを適切に処理します。新しいポジションには入りません。
| `/stop` | トレーダーを停止します
| `/reload_config` | 構成ファイルをリロードします
| `/show_config` | 操作に関連する設定を含む現在の構成の一部を表示します
| `/logs [limit]` | 最後のログメッセージを表示します。
| `/help` | ヘルプメッセージを表示します
| `/version` | バージョンを表示します
| **ステータス** |
| `/status` | すべてのオープントレードを一覧表示します
| `/status <trade_id>` | 1つ以上の特定の取引を一覧表示します。複数の<trade_id>を空白で区切ります。
| `/status table` | すべてのオープントレードを表形式で一覧表示します。保留中の買い注文はアスタリスク（*）でマークされます。保留中の売り注文は二重アスタリスク（**）でマークされます。
| `/order <trade_id>` | 1つ以上の特定の取引の注文を一覧表示します。複数の<trade_id>を空白で区切ります。
| `/trades [limit]` | 最近決済されたすべての取引を表形式で一覧表示します。
| `/count` | 使用済みおよび利用可能な取引の数を表示します
| `/locks` | 現在ロックされているペアを表示します。
| `/unlock <pair or lock_id>` | このペア（またはこのロックID）のロックを解除します。
| `/marketdir [long | short | even | none]` | 現在の市場の方向性を表すユーザー管理変数を更新します。方向が指定されていない場合は、現在設定されている方向が表示されます。
| `/list_custom_data <trade_id> [key]` | 取引IDとキーの組み合わせのcustom_dataを一覧表示します。キーが指定されていない場合は、その取引IDで見つかったすべてのキーと値のペアが一覧表示されます。
| **取引状態の変更** |
| `/forceexit <trade_id> | /fx <tradeid>` | 指定された取引を即座に終了します（`minimum_roi`を無視）。
| `/forceexit all | /fx all` | すべてのオープントレードを即座に終了します（`minimum_roi`を無視）。
| `/fx` | `/forceexit`のエイリアス
| `/forcelong <pair> [rate]` | 指定されたペアを即座に購入します。レートはオプションであり、指値注文にのみ適用されます。（`force_entry_enable`をTrueに設定する必要があります）
| `/forceshort <pair> [rate]` | 指定されたペアを即座に空売りします。レートはオプションであり、指値注文にのみ適用されます。これは非スポット市場でのみ機能します。（`force_entry_enable`をTrueに設定する必要があります）
| `/delete <trade_id>` | データベースから特定の取引を削除します。オープンオーダーを決済しようとします。取引所でのこの取引の手動処理が必要です。
| `/reload_trade <trade_id>` | 取引所から取引をリロードします。ライブでのみ機能し、取引所で手動で売却された取引を回復するのに役立つ可能性があります。
| `/cancel_open_order <trade_id> | /coo <trade_id>` | 取引のオープンオーダーをキャンセルします。
| **メトリクス** |
| `/profit [<n>]` | 過去n日間（デフォルトではすべての取引）の決済取引からの損益の概要とパフォーマンスに関するいくつかの統計を表示します
| `/profit_[long|short] [<n>]` | 過去n日間（デフォルトではすべての取引）の一方向の決済取引からの損益の概要とパフォーマンスに関するいくつかの統計を表示します
| `/performance` | ペアごとにグループ化された各終了取引のパフォーマンスを表示します
| `/balance` | 通貨ごとのボット管理残高を表示します
| `/balance full` | 通貨ごとの口座残高を表示します
| `/daily <n>` | 過去n日間の1日あたりの損益を表示します（nのデフォルトは7）
| `/weekly <n>` | 過去n週間の週ごとの損益を表示します（nのデフォルトは8）
| `/monthly <n>` | 過去nか月間の月ごとの損益を表示します（nのデフォルトは6）
| `/stats` | 終了理由別の勝ち/負け、および買いと売りの平均保有期間を表示します
| `/exits` | 終了理由別の勝ち/負け、および買いと売りの平均保有期間を表示します
| `/entries` | 終了理由別の勝ち/負け、および買いと売りの平均保有期間を表示します
| `/whitelist [sorted] [baseonly]` | 現在のホワイトリストを表示します。オプションで、アルファベット順に表示したり、各ペアリングの基本通貨のみを表示したりできます。
| `/blacklist [pair]` | 現在のブラックリストを表示するか、ペアをブラックリストに追加します。

## 実行中のTelegramコマンド

以下に、各コマンドに対して受信するTelegramメッセージの例を示します。

### /start

> **ステータス：** `実行中`

### /pause | /stopentry | /stopbuy

> **ステータス：** `一時停止中、これ以降エントリは発生しません。エントリを有効にするには/startを実行してください。`

状態を`一時停止`に変更することで、ボットが新しい取引を開始するのを防ぎます。
オープントレードは、通常のルール（ROI /終了シグナル、ストップロスなど）に従って引き続き管理されます。
ポジション調整は終了側でのみアクティブなままであることに注意してください。つまり、ボットが`一時停止`されている場合、オープントレードのポジションサイズを減らすことしかできません。

この後、ボートにオープントレードを終了する時間を与えます（`/status table`で確認できます）。
すべてのポジションが決済されたら、`/stop`を実行してボットを完全に停止します。

`/start`を使用してボットを`実行中`の状態に再開し、新しいポジションを開くことができるようにします。

!!! Warning
    一時停止/停止エントリシグナルは、ボットの実行中にのみアクティブであり、永続化されないため、ボットを再起動するとリセットされます。

### /stop

> `トレーダーを停止しています...`
> **ステータス：** `停止`

### /status

オープントレードごとに、ボットは次のメッセージを送信します。
エントリタグは戦略を介して構成可能です。

> **取引ID：** `123` `(1日前から)`
> **現在のペア：** CVC/BTC
> **方向：** ロング
> **レバレッジ：** 1.0
> **金額：** `26.64180098`
> **エントリタグ：** 素晴らしいロングシグナル
> **オープンレート：** `0.00007489`
> **現在のレート：** `0.00007489`
> **未実現利益：** `12.95%`
> **ストップロス：** `0.00007389 (-0.02%)`

### /status table
すべてのオープントレードのステータスを表形式で返します。
```
ID L/S    ペア     開始   利益
----    --------  -------  --------
  67 L   SC/BTC    1 d      13.33%
 123 S   CVC/BTC   1 h      12.95%
```
### /count

使用済みおよび利用可能な取引の数を返します。
```
現在    最大
---------  -----
     2     10
```
### /profit

`/profit_long`および`/profit_short`としても利用でき、ロングまたはショートトレードのみの利益を表示します。

損益とパフォーマンスの概要を返します。

> **ROI：** 決済済み取引
>   ∙ `0.00485701 BTC (2.2%) (15.2 Σ%)`
>   ∙ `62.968 USD`
> **ROI：** すべての取引
>   ∙ `0.00255280 BTC (1.5%) (6.43 Σ%)`
>   ∙ `33.095 EUR`
>  
> **総取引数：** `138`
> **ボット開始：** `2022-07-11 18:40:44`
> **最初の取引開始：** `3日前`
> **最新の取引開始：** `2分前`
> **平均期間：** `2:33:45`
> **最高成績：** `PAY/BTC: 50.23%`
> **取引量：** `0.5 BTC`
> **利益率：** `1.04`
> **勝ち/負け：** `102 / 36`
> **勝率：** `73.91%`
> **期待値（比率）：** `4.87 (1.66)`
> **最大ドローダウン：** `9.23% (0.01255 BTC)`

`1.2%`の相対利益は、取引ごとの平均利益です。
`15.2 Σ%`の相対利益は、開始資本に基づいています。この場合、開始資本は`0.00485701 * 1.152 = 0.00738 BTC`でした。
**開始資本（**）は、`available_capital`設定から取得されるか、現在のウォレットサイズ-利益を使用して計算されます。
**利益率**は、総利益/総損失として計算され、戦略の全体的な指標として機能します。
**期待値**は、リスクのある通貨単位あたりの平均リターンに対応します。つまり、勝率とリスクリワード比（勝ちトレードの平均利益と負けトレードの平均損失の比較）です。
**期待値比率**は、過去のすべての取引のパフォーマンスに基づいて、後続の取引の期待される利益または損失です。
**最大ドローダウン**は、バックテストメトリック`絶対ドローダウン（アカウント）`に対応します-`（絶対ドローダウン）/（ドローダウンハイ+開始残高）`として計算されます。
**ボット開始日**は、ボットが最初に開始された日付を参照します。古いボットの場合、これは最初の取引のオープン日にデフォルト設定されます。

### /forceexit <trade_id>

> **BINANCE：** BTC/LTCを指値`0.01650000`で決済（利益：〜-4.07％、-0.00008168）

!!! Tip
    パラメータなしで`/forceexit`を呼び出すと、すべてのオープントレードのリストが表示され、取引を簡単に終了するためのボタンが表示されます。
    このコマンドには`/fx`というエイリアスがあります。これは同じ機能を持ちますが、「緊急」事態では入力が速くなります。

### /forcelong <pair> [rate] | /forceshort <pair> [rate]
`/forcebuy <pair> [rate]`もロングでサポートされていますが、非推奨と見なすべきです。

> **BINANCE：** ETH/BTCを指値`0.03400000`でロング（`1.000000 ETH`、`225.290 USD`）

ペアを省略すると、取引するペアを尋ねるクエリが開きます（現在のホワイトリストに基づく）。
`/forcelong`を介して作成された取引には、`force_entry`の購入タグが付きます。

![Telegram force-buy screenshot](assets/telegram_forcebuy.png)

これが機能するには、`force_entry_enable`をtrueに設定する必要があることに注意してください。

[詳細](configuration.md#understand-force_entry_enable)

### /performance

ボットが販売した各暗号通貨のパフォーマンスを返します。
> パフォーマンス：
> 1. `RCN/BTC 0.003 BTC (57.77%) (1)`
> 2. `PAY/BTC 0.0012 BTC (56.91%) (1)`
> 3. `VIB/BTC 0.0011 BTC (47.07%) (1)`
> 4. `SALT/BTC 0.0010 BTC (30.24%) (1)`
> 5. `STORJ/BTC 0.0009 BTC (27.24%) (1)`
> ...

相対的なパフォーマンスは、通貨への総投資に対して計算され、通貨のすべての約定済みエントリを集計します。

### /balance

取引所にあるすべての暗号通貨の残高を返します。

> **通貨：** BTC
> **利用可能：** 3.05890234
> **残高：** 3.05890234
> **保留中：** 0.0
>
> **通貨：** CVC
> **利用可能：** 86.64180098
> **残高：** 86.64180098
> **保留中：** 0.0

### /daily <n>

デフォルトでは、`/daily`は過去7日間を返します。以下の例は`/daily 3`の場合です。

> **過去3日間の日次利益：**
```
日（カウント）     USDT          USD         利益％
--------------  ------------  ----------  ----------
2022-06-11 (1)  -0.746 USDT   -0.75 USD   -0.08%
2022-06-10 (0)  0 USDT        0.00 USD    0.00%
2022-06-09 (5)  20 USDT       20.10 USD   5.00%
```
### /weekly <n>

デフォルトでは、`/weekly`は現在週を含む過去8週間を返します。各週は月曜日から始まります。以下の例は`/weekly 3`の場合です。

> **過去3週間の週次利益（月曜日から）：**
```
月曜日（カウント）  利益BTC      利益USD   利益％
-------------  --------------  ------------    ----------
2018-01-03 (5)  0.00224175 BTC  29,142 USD   4.98%
2017-12-27 (1)  0.00033131 BTC   4,307 USD   0.00%
2017-12-20 (4)  0.00269130 BTC  34.986 USD   5.12%
```
### /monthly <n>

デフォルトでは、`/monthly`は現在月を含む過去6か月を返します。以下の例は`/monthly 3`の場合です。

> **過去3か月間の月次利益：**
```
月（カウント）  利益BTC      利益USD    利益％
-------------  --------------  ------------    ----------
2018-01 (20)    0.00224175 BTC  29,142 USD  4.98%
2017-12 (5)    0.00033131 BTC   4,307 USD   0.00%
2017-11 (10)    0.00269130 BTC  34.986 USD  5.10%
```
### /whitelist

現在のホワイトリストを表示します

> ホワイトリスト`StaticPairList`を22ペアで使用しています
> `IOTA/BTC, NEO/BTC, TRX/BTC, VET/BTC, ADA/BTC, ETC/BTC, NCASH/BTC, DASH/BTC, XRP/BTC, XVG/BTC, EOS/BTC, LTC/BTC, OMG/BTC, BTG/BTC, LSK/BTC, ZEC/BTC, HOT/BTC, IOTX/BTC, XMR/BTC, AST/BTC, XLM/BTC, NANO/BTC`

### /blacklist [pair]

現在のブラックリストを表示します。
ペアが設定されている場合、このペアがペアリストに追加されます。
スペースで区切られた複数のペアもサポートします。
ブラックリストをリセットするには、`/reload_config`を使用します。

> ブラックリスト`StaticPairList`を2ペアで使用しています
>`DODGE/BTC`、`HOT/BTC`。

### /version

> **バージョン：** `0.14.3`

### /marketdir

市場の方向性が指定されている場合、コマンドは現在の市場の方向性を表すユーザー管理変数を更新します。
この変数は、ボットの起動時に有効な市場の方向性に設定されておらず、ユーザーが設定する必要があります。以下の例は`/marketdir long`の場合です。
```
市場の方向性をnoneからlongに正常に更新しました。
```
市場の方向性が指定されていない場合、コマンドは現在設定されている市場の方向性を出力します。以下の例は`/marketdir`の場合です。
```
現在設定されている市場の方向性：even
```
`self.market_direction`を介して戦略で市場の方向性を使用できます。

!!! Warning "ボットの再起動"
    市場の方向性は永続化されず、ボットの再起動/リロード後にリセットされることに注意してください。

!!! Danger "バックテスト"
    この値/変数は、ドライ/ライブ取引で手動で変更することを目的としているためです。
    `market_direction`を使用する戦略は、信頼できる、再現可能な結果を生成しない可能性があります（この変数への変更はバックテストに反映されません）。自己責任で使用してください。