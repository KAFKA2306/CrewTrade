# レバレッジを使った取引

!!! Warning "ベータ版機能"
    この機能はまだテスト段階です。間違っていると思われる点に気づいた場合は、Discord または Github Issue 経由でお知らせください。

!!! Note "1 つのアカウントに複数のボット"
    レバレッジを使用して同じアカウントで 2 つのボットを実行することはできません。レバレッジ取引/証拠金取引の場合、freqtrade はアカウントの唯一のユーザーであると想定し、すべての清算レベルはこの想定に基づいて計算されます。

!!! Danger "レバレッジをかけて取引するのは非常に危険です"
    スポット市場を使用したライブ実行でプラスの結果が示されていない戦略を使用して、レバレッジ > 1 で取引しないでください。戦略のストップロスを確認してください。レバレッジが 2 の場合、ストップロス 0.5 (50%) は低すぎるため、これらの取引はそのストップロスに達する前に清算されてしまいます。
    本ソフトウェアまたは本モードの使用により生じた最終的な損失については、当社は一切の責任を負いません。

    freqtrade (および戦略) がどのように機能するかを理解している場合にのみ、高度な取引モードを使用してください。
    また、失うことができる以上のリスクを決して負わないでください。

すでに既存の戦略をお持ちの場合は、[戦略移行ガイド](strategy_migration.md#strategy-migration-between-v2-and-v3) を読んで、freqtrade v2 戦略から、先物の空売りと取引ができるバージョン 3 の戦略に戦略を移行してください。

## ショート

[`trading_mode`](#leverage-trading-modes) を `spot` に設定して取引する場合、空売りはできません。空売りするには、`trading_mode` を `margin`(現在利用不可) または [`futures`](#futures) に設定し、[`margin_mode`](#margin-mode) を [`cross`](#cross-margin-mode) または [`isoulated`](#isoulated-margin-mode) に設定する必要があります。

ストラテジをショートするには、ストラテジ クラスでクラス変数 `can_short = True` を設定する必要があります。

ショートトレードをエントリーおよびエグジットするためのシグナルの設定方法については、[戦略のカスタマイズ](strategy-customization.md#entry-signal-rules) をお読みください。

## `trading_mode` を理解する

可能な値は、「スポット」(デフォルト)、「マージン」(*現在利用不可*)、または「先物」です。

### スポット

通常取引モード（低リスク）

- ロング取引のみ (ショート取引は不可)。
- レバレッジはありません。
- 清算はありません。
- 得られた利益または失われた利益は、資産価値の変化に等しくなります（取引手数料を差し引いたもの）。

### 取引モードを活用する

レバレッジを利用して、トレーダーは取引所から資金を借ります。資本は取引所に全額返済される必要があり（場合によっては利息が付きます）、トレーダーは借りた資本を使用して行われた取引から得た利益を保持するか、損失を支払います。
資本は常に返済する必要があるため、トレーダーが借入資産を取引所に返済するのに十分な資本を確保するために、レバレッジ口座の資産総額が一定のポイント（損失の総額がトレーダーが実際にレバレッジ口座で所有している担保の価値よりも小さいポイント）まで低下すると、取引所は借入資本を使用して行われた取引を**清算**（トレーダーの資産を強制的に売却）します。また、取引所は**清算手数料**も請求するため、トレーダーの損失はさらに増加し​​ます。

このため、**自分が何をしているのか正確に理解していない場合は、レバレッジを使って取引しないでください。レバレッジ取引はハイリスクであり、資産価値が急速にゼロになり、再び価値が増加する可能性はありません。**

#### マージン (現在利用不可)

取引はスポット市場で行われますが、取引所は選択したレバレッジに等しい金額の通貨を貸し出します。貸した金額を利子とともに取引所に返済すると、利益/損失に指定されたレバレッジが掛けられます。

#### 先物

無期限スワップ (無期限先物としても知られる) は、そのベースとなる原資産と密接に結びついた価格で取引される契約です (例)。実際の資産を取引しているのではなく、デリバティブ契約を取引しています。無期限スワップ契約は、先物やオプション契約とは異なり、無期限に継続できます。

先物契約の価格変動による損益に加えて、トレーダーは、先物契約と原資産との価格差から得られる金額に相当する損益である「資金調達手数料」も交換します。先物契約と原資産との価格差は取引所によって異なります。

先物市場で取引するには、「trading_mode」を「先物」に設定する必要があります。
また、「マージン モード」 (下記の説明) を選択する必要があります。現在、freqtrade は分離マージンのみをサポートしています。
``` json
"trading_mode": "futures",
"margin_mode": "isolated"
```
##### ペアの命名

Freqtrade は [ccxt の先物命名規則](https://docs.ccxt.com/#/README?id=perpetual-swap-perpetual-future) に従います。
したがって、先物ペアには「base/quote:settle」という名前が付けられます (例: 「ETH/USDT:USDT」)。

### マージンモード

「trading_mode」に加えて、「margin_mode」も設定する必要があります。
freqtrade は現在 1 つのマージン モードのみをサポートしていますが、これは変更される予定であり、今設定することで将来のアップデートに備えることができます。

可能な値は、「孤立」または「クロス」です。

#### 分離マージン モード

各市場（取引ペア）ごとに担保を別の口座に保管します
``` json
"margin_mode": "isolated"
```
#### クロスマージンモード

1 つのアカウントは、市場 (取引ペア) 間で担保を共有するために使用されます。証拠金は、必要な場合の清算を避けるために、口座残高の合計から差し引かれます。
``` json
"margin_mode": "cross"
```
このモードをサポートする取引所とその違いについては、[取引所固有のメモ](exchanges.md) をお読みください。

!!! Warning "清算リスクの増加"
    クロスマージンモードでは、すべての取引が同じ担保を共有するため、口座が完全に清算されるリスクが高まります。
    1 つの取引で損失が発生すると、他の取引の清算価格に影響を与える可能性があります。  
    また、クロスポジションの影響は、ドライラン モードやバックテスト モードでは完全にはシミュレートされない場合があります。

## 使用するレバレッジを設定する

戦略やリスク プロファイルが異なれば、必要なレバレッジのレベルも異なります。
1 つの静的なレバレッジ値を設定することもできますが、freqtrade では [戦略レバレッジ コールバック](strategy-callbacks.md#leverage-callback) を介してこれを調整する柔軟性を提供します。これにより、ペアごとに、または戦略の結果に有利な他の要因に基づいて、異なるレバレッジを使用できます。

実装されていない場合、レバレッジはデフォルトで 1x (レバレッジなし) になります。

!!! Warning
    レバレッジが高いほどリスクも高くなります。レバレッジを使用する場合の影響を十分に理解してください。

## `liquidation_buffer` を理解する

*デフォルトは「0.05」です*

ポジションが清算価格に達するのを防ぐために、清算価格とストップロスの間にどのくらいの大きさのセーフティネットを置くかを指定する比率。
この人為的清算価格は次のように計算されます。

`freqtrade_liquidation_price = 清算価格 ± (abs(open_rate - 清算価格) * 清算バッファ)`

- ロングトレードの場合は `±` = `+`
- ショートトレードの場合は `±` = `-`

可能な値は、0.0 ～ 0.99 の任意の浮動小数点数です。

**例:** 取引が 10 コイン/USDT の価格でエントリーされ、この取引の清算価格が 8 コイン/USDT の場合、「liquidation_buffer」を「0.05」に設定すると、この取引の最小ストップロスは $8 + ((10 - 8) * 0.05) = 8 + 0.1 = 8.1$ になります。

!!! Danger "`liquidation_buffer` が 0.0、または `liquidation_buffer` が低い場合、清算および清算手数料が発生する可能性があります。"
    現在、Freqtrade は清算価格を計算できますが、清算手数料は計算できません。 `liquidation_buffer` を 0.0 に設定するか、低い `liquidation_buffer` を使用すると、ポジションが清算される可能性があります。 Freqtrade は清算手数料を追跡しないため、清算によりボットの損益結果が不正確になります。低い `liquidation_buffer` を使用する場合、取引所がこれをサポートしている場合は `stoploss_on_exchange` を使用することをお勧めします。

## 利用できない資金調達レート
先物データの場合、取引所は通常、先物のローソク足、マーク、資金調達レートを提供します。ただし、ローソク足やマークが利用可能であっても、資金調達レートが利用できないことはよくあります。これはバックテストの時間範囲に影響を与える可能性があります。つまり、以前の時間範囲ではなく最近の時間範囲のみをテストでき、「データが見つかりません」というエラーが発生する可能性があります。終了します。」エラー。これを回避するには、[configuration.md](configuration.md) にリストされているように `futures_funding_rate` 設定オプションを追加します。ペア、取引所、および時間範囲の特定の資金調達レートがわからない場合を除き、これを `0` に設定することをお勧めします。これを「0」以外に設定すると、戦略内の利益計算に大きな影響を与える可能性があります。 `custom_exit`、`custom_stoploss` などの関数内で。

!!! Warning "これは、バックテストが不正確であることを意味します。"
    これにより、取引所から利用可能な資金調達レートが上書きされることはありませんが、誤った資金調達レートを設定すると、資金調達レートが利用できない過去の時間範囲ではバックテスト結果が不正確になることを意味することに留意してください。

### 開発者

#### マージンモード

ショートの場合、「借りた」通貨の金利手数料を支払う通貨がクローズ取引と同時に購入されます（これは、ショートクローズ取引で購入した金額がショートオープニング取引で売った金額よりも大きいことを意味します）。

ロングの場合、「借りた」通貨に対して利息を支払う通貨はすでにユーザーによって所有されており、購入する必要はありません。利息は取引の「close_value」から差し引かれます。

すべての手数料は、取引中の「current_profit」計算に含まれます。

#### 先物モード

資金調達手数料は取引総額から加算または減算されます。
