# データのダウンロード

## バックテストとハイパーオプト用のデータの取得

バックテストと超最適化に必要なデータ (ローソク足/OHLCV) をダウンロードするには、`freqtrade download-data` コマンドを使用します。

追加のパラメーターが指定されていない場合、freqtrade は過去 30 日間の `"1m"` および `"5m"` の時間枠のデータをダウンロードします。
Exchange とペアは `config.json` から取得されます (`-c/--config` を使用して指定した場合)。
構成が提供されていない場合、「--exchange」は必須になります。

相対的な時間範囲 (「--days 20」) または絶対的な開始点 (「--timerange 20200101-」) を使用できます。増分ダウンロードの場合は、相対的なアプローチを使用する必要があります。

!!!ヒント「ヒント: 既存のデータの更新」
    データ ディレクトリに利用可能なバックテスト データがすでにあり、このデータを今日まで更新したい場合、freqtrade は既存のペアの欠落している時間範囲を自動的に計算し、利用可能な最新の時点から「現在」までダウンロードが行われます。`--days` パラメーターも `--timerange` パラメーターも必要ありません。 Freqtrade は利用可能なデータを保持し、不足しているデータのみをダウンロードします。  
    データのない新しいペアを挿入した後に既存のデータを更新する場合は、「--new-pairs-days xx」パラメータを使用します。新しいペアについては指定された日数がダウンロードされ、古いペアは欠落したデータのみで更新されます。  

### 使用法

--8<-- "commands/download-data.md"

!!!ヒント「1 つの相場通貨のすべてのデータをダウンロードする」
    多くの場合、特定の相場通貨のすべてのペアのデータをダウンロードしたいことがあります。このような場合は、次の省略表現を使用できます。
    `freqtrade download-data --exchange binance --pairs ".*/USDT" <...>`。指定された「ペア」文字列は、取引所上のすべてのアクティブなペアを含むように拡張されます。
    非アクティブな (リストから削除された) ペアのデータもダウンロードするには、コマンドに `--include-inactive-pairs` を追加します。

!!!注意「起動期間」
    `download-data` は戦略に依存しないコマンドです。このアイデアは、大量のデータを一度ダウンロードし、保存されるデータの量を繰り返し増加させることです。

    そのため、`download-data` はストラテジで定義された「起動期間」を気にしません。バックテストを特定の時点で (開始期間を考慮しながら) 開始する必要がある場合は、追加の日数をダウンロードするかどうかはユーザー次第です。

### ダウンロードを開始します

非常に単純なコマンド (利用可能な `config.json` ファイルがあると仮定) は次のようになります。
```bash
freqtrade download-data --exchange binance
```
これにより、設定で定義されたすべての通貨ペアのヒストリカル ローソク足 (OHLCV) データがダウンロードされます。

または、ペアを直接指定します
```bash
freqtrade download-data --exchange binance --pairs ETH/USDT XRP/USDT BTC/USDT
```
または正規表現として (この場合、すべてのアクティブな USDT ペアをダウンロードするため)
```bash
freqtrade download-data --exchange binance --pairs ".*/USDT"
```
### その他の注意事項

* Exchange 固有のデフォルトとは異なるディレクトリを使用するには、「--datadir user_data/data/some_directory」を使用します。
* 履歴データのダウンロードに使用される取引所を変更するには、「--exchange <exchange>」を使用するか、別の設定ファイルを指定します。
* 他のディレクトリから `pairs.json` を使用するには、`--pairs-file some_other_dir/pairs.json` を使用します。
* 10 日間のみのヒストリカル ローソク足 (OHLCV) データをダウンロードするには、`--days 10` を使用します (デフォルトは 30 日)。
* 固定開始点からヒストリカル ローソク足 (OHLCV) データをダウンロードするには、「--timerange 20200101-」を使用します。これにより、2020 年 1 月 1 日からのすべてのデータがダウンロードされます。
* データがすでに利用可能な場合、指定された開始点は無視され、今日までの不足しているデータのみがダウンロードされます。
* `--timeframes` を使用して、ヒストリカル ローソク足 (OHLCV) データをダウンロードする時間枠を指定します。デフォルトは「--timeframes 1m 5m」で、1 分と 5 分のデータをダウンロードします。
* 設定ファイルで定義されているエクスチェンジ、タイムフレーム、ペアのリストを使用するには、`-c/--config` オプションを使用します。これにより、スクリプトはデータをダウンロードする通貨ペアのリストとして構成で定義されたホワイトリストを使用し、pairs.json ファイルを必要としません。 `-c/--config` を他のほとんどのオプションと組み合わせることができます。

??? 「アクセス許可拒否エラー」に注意してください。
    構成ディレクトリ `user_data` が docker によって作成された場合、次のエラーが発生する可能性があります。
    ```
    cp: cannot create regular file 'user_data/data/binance/pairs.json': Permission denied
    ```
次のようにして、ユーザー データ ディレクトリの権限を修正できます。
    ```
    sudo chown -R $UID:$GID user_data
    ```
### 現在の時間範囲より前に追加データをダウンロードする

2022 年からすべてのデータをダウンロードしたと仮定します (`--timerange 20220101-`)。ただし、以前のデータでもバックテストしたいとします。
これを行うには、「--prepend」フラグを「--timerange」と組み合わせて使用​​し、終了日を指定します。
``` bash
freqtrade download-data --exchange binance --pairs ETH/USDT XRP/USDT BTC/USDT --prepend --timerange 20210101-20220101
```
!!!注記
    データが利用可能な場合、Freqtrade はこのモードで終了日を無視し、終了日を既存のデータの開始点に更新します。

### データ形式

Freqtrade は現在、次のデータ形式をサポートしています。

* `feather` - Apache Arrow に基づくデータ形式
* `json` - プレーンな「テキスト」json ファイル
* `jsongz` - json ファイルの gzip 圧縮バージョン
* `parquet` - 列指向データストア (OHLCV のみ)

デフォルトでは、OHLCV データと取引データは両方とも「フェザー」形式で保存されます。

これは、それぞれ「--data-format-ohlcv」および「--data-format-trades」コマンドライン引数を介して変更できます。
この変更を永続化するには、次のスニペットを構成に追加する必要もあります。これにより、毎回上記の引数を挿入する必要がなくなります。
``` jsonc
    // ...
    "dataformat_ohlcv": "feather",
    "dataformat_trades": "feather",
    // ...
```
ダウンロード中にデフォルトのデータ形式が変更された場合は、設定ファイル内のキー「dataformat_ohlcv」と「dataformat_trades」も選択したデータ形式に合わせて調整する必要があります。

!!!注記
    [convert-data](#sub-command-convert-data) メソッドと [convert-trade-data](#sub-command-convert-trade-data) メソッドを使用して、データ形式を変換できます。

#### データ形式の比較

次の比較は、次のデータと Linux の `time` コマンドを使用して行われました。
```
Found 6 pair / timeframe combinations.
+----------+-------------+--------+---------------------+---------------------+
|     Pair |   Timeframe |   Type |                From |                  To |
|----------+-------------+--------+---------------------+---------------------|
| BTC/USDT |          5m |   spot | 2017-08-17 04:00:00 | 2022-09-13 19:25:00 |
| ETH/USDT |          1m |   spot | 2017-08-17 04:00:00 | 2022-09-13 19:26:00 |
| BTC/USDT |          1m |   spot | 2017-08-17 04:00:00 | 2022-09-13 19:30:00 |
| XRP/USDT |          5m |   spot | 2018-05-04 08:10:00 | 2022-09-13 19:15:00 |
| XRP/USDT |          1m |   spot | 2018-05-04 08:11:00 | 2022-09-13 19:22:00 |
| ETH/USDT |          5m |   spot | 2017-08-17 04:00:00 | 2022-09-13 19:20:00 |
+----------+-------------+--------+---------------------+---------------------+
```
次のコマンドを使用すると、あまり科学的ではない方法でタイミングが取得され、データをメモリに強制的に読み込むことができます。
``` bash
time freqtrade list-data --show-timerange --data-format-ohlcv <dataformat>
```
|  フォーマット |サイズ |タイミング |
|-----------|---------------|---------------|
| '羽' | 72MB | 3.5秒 |
| `json` | 149MB | 25.6秒 |
| `jsongz` | 39MB | 27秒 |
|寄木細工83MB | 3.8秒 |

サイズは、上記で指定された時間範囲の BTC/USDT 1m スポットの組み合わせから取得されています。

パフォーマンスとサイズの組み合わせを最適化するには、デフォルトのフェザー形式、つまり寄木細工を使用することをお勧めします。

### ペアファイル

「config.json」のホワイトリストの代わりに、「pairs.json」ファイルを使用できます。
たとえば、Binance を使用している場合:

* ディレクトリ `user_data/data/binance` を作成し、そのディレクトリに `pairs.json` ファイルをコピーまたは作成します。
* 関心のある通貨ペアが含まれるように「pairs.json」ファイルを更新します。
```bash
mkdir -p user_data/data/binance
touch user_data/data/binance/pairs.json
```
「pairs.json」ファイルの形式は、単純な JSON リストです。
このファイルはダウンロードにのみ使用されるため、異なるステーク通貨の混合が許可されています。
``` json
[
    "ETH/BTC",
    "ETH/USDT",
    "BTC/USDT",
    "XRP/ETH"
]
```
!!!注記
    `pairs.json` ファイルは、設定が読み込まれていない場合にのみ使用されます (名前付けまたは `--config` フラグによって暗黙的に)。
    `--pairs-filepairs.json` を介してこのファイルの使用を強制できますが、構成内の `exchange.pair_whitelist` または `pairs` 設定を介して、構成内からペアリストを使用することをお勧めします。

## サブコマンドデータ変換

--8<-- "commands/convert-data.md"

### データの変換例

次のコマンドは、`~/.freqtrade/data/binance` で利用可能なすべてのローソク足 (OHLCV) データを json から jsongz に変換し、プロセスのディスク領域を節約します。
また、元の json データ ファイル (`--erase` パラメーター) も削除されます。
``` bash
freqtrade convert-data --format-from json --format-to jsongz --datadir ~/.freqtrade/data/binance -t 5m 15m --erase
```
## サブコマンド 取引データの変換

--8<-- "commands/convert-trade-data.md"

### 取引の変換例

次のコマンドは、`~/.freqtrade/data/kraken` 内の利用可能なすべての取引データを jsongz から json に変換します。
また、元の jsongz データ ファイルも削除されます (`--erase` パラメーター)。
``` bash
freqtrade convert-trade-data --format-from jsongz --format-to json --datadir ~/.freqtrade/data/kraken --erase
```
## サブコマンドは ohlcv にトレードします

データをダウンロードするために `--dl-trades` (kraken のみ) を使用する必要がある場合、取引データを ohlcv データに変換するのが最後のステップです。
このコマンドを使用すると、データを再ダウンロードせずに、追加の時間枠でこの最後のステップを繰り返すことができます。

--8<-- "commands/trades-to-ohlcv.md"

### trade-to-ohlcv 変換の例
``` bash
freqtrade trades-to-ohlcv --exchange kraken -t 5m 1h 1d --pairs BTC/EUR ETH/EUR
```
## サブコマンドリストデータ

ダウンロードしたデータのリストは「list-data」サブコマンドを使用して取得できます。

--8<-- "commands/list-data.md"

### リストデータの例
```bash
> freqtrade list-data --userdir ~/.freqtrade/user_data/

              Found 33 pair / timeframe combinations.
┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━┓
┃          Pair ┃                                 Timeframe ┃ Type ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━┩
│       ADA/BTC │     5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d │ spot │
│       ADA/ETH │     5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d │ spot │
│       ETH/BTC │     5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d │ spot │
│      ETH/USDT │                  5m, 15m, 30m, 1h, 2h, 4h │ spot │
└───────────────┴───────────────────────────────────────────┴──────┘

```
開始/終了の時間範囲を含むすべての取引データを表示します
``` bash
> freqtrade list-data --show --trades
                     Found trades data for 1 pair.                     
┏━━━━━━━━━┳━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    Pair ┃ Type ┃                From ┃                  To ┃ Trades ┃
┡━━━━━━━━━╇━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ XRP/ETH │ spot │ 2019-10-11 00:00:11 │ 2019-10-13 11:19:28 │  12477 │
└─────────┴──────┴─────────────────────┴─────────────────────┴────────┘

```
## 取引 (ティック) データ

デフォルトでは、「download-data」サブコマンドはキャンドル (OHLCV) データをダウンロードします。ほとんどの取引所は、API 経由で過去の取引データも提供します。
このデータは、一度ダウンロードされるだけで、ローカルで希望の時間枠にリサンプリングされるため、多くの異なる時間枠が必要な場合に役立ちます。

このデータはデフォルトで大きいため、ファイルはデフォルトでフェザー ファイル形式を使用します。これらは、`<pair>-trades.feather` (`ETH_BTC-trades.feather`) の命名規則に従ってデータ ディレクトリに保存されます。履歴 OHLCV データと同様に増分モードもサポートされているため、「--days 8」を使用して週に 1 回データをダウンロードすると、増分データ リポジトリが作成されます。

このモードを使用するには、呼び出しに「--dl-trades」を追加するだけです。これにより、ダウンロード方法が取引のダウンロードに切り替わります。
`--convert` も指定すると、リサンプル ステップが自動的に実行され、最終的には指定されたペア/タイムフレームの組み合わせに対する既存の OHLCV データが上書きされます。

!!!警告「使用しないでください」
    kraken ユーザーでない限り、これを使用しないでください (Kraken は履歴 OHLCV データを提供しません)。  
    他のほとんどの取引所は、十分な履歴を含む OHLCV データを提供しているため、その方法で複数のタイムフレームをダウンロードする方が、取引データをダウンロードするよりもはるかに高速であることがわかります。

!!!注「クラーケン使い」
    Kraken ユーザーは、データのダウンロードを開始する前に [これ](exchanges.md#history-kraken-data) を読む必要があります。

呼び出しの例:
```bash
freqtrade download-data --exchange kraken --pairs XRP/EUR ETH/EUR --days 20 --dl-trades
```
!!!注記
    このメソッドは非同期呼び出しを使用しますが、交換への次のリクエストを生成するには前の呼び出しの結果が必要であるため、速度が遅くなります。

## 次のステップ

データがダウンロードされたので、戦略の [バックテスト](backtesting.md) を開始できます。
