# バックテスト

このページでは、バックテストを使用して戦略のパフォーマンスを検証する方法について説明します。

バックテストには履歴データが必要です。
関心のあるペアと交換のデータを取得する方法については、ドキュメントの [データのダウンロード](data-download.md) セクションにアクセスしてください。

バックテストは [Web サーバー モード](freq-ui.md#backtesting) でも利用でき、Web インターフェイス経由でバックテストを実行できます。

## バックテスト コマンド リファレンス

--8<-- "commands/backtesting.md"

## バックテストで戦略をテストする

これで、優れた参入戦略と撤退戦略といくつかの履歴データが得られたので、それをテストしてみます。
実際のデータ。これは私たちが [バックテスト](https://en.wikipedia.org/wiki/Backtesting) と呼ぶものです。

バックテストでは、設定ファイルの暗号通貨 (ペア) が使用され、デフォルトで `user_data/data/<exchange>` から履歴ローソク足 (OHLCV) データがロードされます。
取引所/ペア/タイムフレームの組み合わせに利用可能なデータがない場合、バックテストでは最初に「freqtrade download-data」を使用してデータをダウンロードするように求められます。
ダウンロードの詳細については、ドキュメントの「データダウンロード」(data-download.md)を参照してください。

バックテストの結果により、ボットが損失よりも利益を得る可能性が高いかどうかが確認されます。

すべての利益の計算には手数料が含まれており、freqtrade は計算に取引所のデフォルトの手数料を使用します。

!!!警告「バックテストに動的ペアリストを使用する」
    動的ペアリストの使用は可能ですが (すべてのハンドラーがバックテスト モードで使用できるわけではありません)、現在の市場状況に依存します。これはペアリストの履歴ステータスを反映しません。
    また、StaticPairlist以外のペアリストを使用した場合、バックテスト結果の再現性は保証できません。
    詳細については、[ペアリストのドキュメント](plugins.md#pairlists) を参照してください。

    再現可能な結果を​​得るには、[`test-pairlist`](utils.md#test-pairlist) コマンドを使用してペアリストを生成し、それを静的ペアリストとして使用するのが最善です。

!!!注記
    デフォルトでは、Freqtrade はバックテスト結果を「user_data/backtest_results」にエクスポートします。
    エクスポートされた取引は、[さらなる分析](#further-backtest-result-analysis) に使用することも、スクリプト ディレクトリ内の [プロット サブコマンド](plotting.md#plot-price-and-indicators) (`freqtrade put-dataframe`) によって使用することもできます。


### 開始残高

バックテストには開始残高が必要です。これは、`--dry-run-wallet <balance>` または `--starting-balance <balance>` コマンドライン引数として、または `dry_run_wallet` 構成設定を介して指定できます。
この金額は「stake_amount」より大きくなければなりません。そうでない場合、ボットは取引をシミュレートできません。

### 動的ステーク額
バックテストは、`stake_amount` を `"unlimited"` として設定することで [動的ステーク量](configuration.md#dynamic-stake-amount) をサポートします。これにより、開始残高が `max_open_trades` 部分に分割されます。
初期の取引で利益が得られると、その後の賭け金が増加し、バックテスト期間中に利益が複利化します。

### バックテスト コマンドの例

5 分足ローソク足 (OHLCV) データ付き (デフォルト)
```bash
freqtrade backtesting --strategy AwesomeStrategy
```
ここで、`--strategy AwesomeStrategy` / `-s AwesomeStrategy` は、`user_data/strategies` ディレクトリの Python ファイル内にあるストラテジーのクラス名を指します。

---

1 分ローソク足 (OHLCV) データ付き
```bash
freqtrade backtesting --strategy AwesomeStrategy --timeframe 1m
```
---

カスタム開始残高 1000 (ステーク通貨) を提供します。
```bash
freqtrade backtesting --strategy AwesomeStrategy --dry-run-wallet 1000
```
---

別のディスク上のヒストリカル キャンドル (OHLCV) データ ソースの使用

Binance 取引所から履歴データをダウンロードし、`user_data/data/binance-20180101` ディレクトリに保存したと仮定します。 
このデータは、次のようにバックテストに使用できます。
```bash
freqtrade backtesting --strategy AwesomeStrategy --datadir user_data/data/binance-20180101 
```
---

複数の戦略の比較
```bash
freqtrade backtesting --strategy-list SampleStrategy1 AwesomeStrategy --timeframe 5m
```
ここで、`SampleStrategy1` と `AwesomeStrategy` はストラテジのクラス名を指します。

---

取引をファイルにエクスポートしないようにする
```bash
freqtrade backtesting --strategy backtesting --export none --config config.json 
```
これは、結果をさらにプロットしたり分析したくない場合にのみ使用してください。

---

カスタムディレクトリを指定して取引をファイルにエクスポートする
```bash
freqtrade backtesting --strategy backtesting --export trades --backtest-directory=user_data/custom-backtest-results
```
---

[戦略起動期間](strategy-customization.md#strategy-startup-period)についてもお読みください。

---

カスタム料金値の提供

アカウントに特定の手数料リベート (特定のアカウント サイズまたは月次ボリュームから始まる手数料減額) が適用される場合がありますが、これらは ccxt には表示されません。
バックテストでこれを考慮するには、「--fee」コマンド ライン オプションを使用して、この値をバックテストに提供します。
この手数料は比率である必要があり、2 回適用されます (取引のエントリに 1 回、取引の終了に 1 回)。

たとえば、注文あたりの手数料が 0.1% (つまり、比率として書かれた 0.001) の場合、次のようにバックテストを実行します。
```bash
freqtrade backtesting --fee 0.001
```
!!!注記
    さまざまな料金値を試したい場合にのみ、このオプション (または対応する構成パラメーター) を指定します。デフォルトでは、バックテストは取引ペア/市場情報からデフォルトの手数料を取得します。

---

タイムレンジを使用して、より小さいテストセットでバックテストを実行する

`--timerange` 引数を使用して、使用するテストセットの量を変更します。

たとえば、「--timerange=20190501-」オプションを指定してバックテストを実行すると、入力データから 2019 年 5 月 1 日以降の利用可能なすべてのデータが使用されます。
```bash
freqtrade backtesting --timerange=20190501-
```
特定の日付範囲を指定することもできます。

全時間範囲の仕様:

- 2018/01/31 までのデータを使用: `--timerange=-20180131`
- 2018/01/31 以降のデータを使用: `--timerange=20180131-`
- 2018/01/31 から 2018/03/01 までのデータを使用: `--timerange=20180131-20180301`
- POSIX / エポックタイムスタンプ 1527595200 1527618600 間のデータを使用: `--timerange=1527595200-1527618600`

## バックテストの結果を理解する

バックテストで最も重要なのは結果を理解することです。

バックテストの結果は次のようになります。
```
                                                 BACKTESTING REPORT                                                  
┏━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃          Pair ┃ Trades ┃ Avg Profit % ┃ Tot Profit USDT ┃ Tot Profit % ┃    Avg Duration ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ LTC/USDT:USDT │     16 │          1.0 │          56.176 │         5.62 │        16:16:00 │   16     0     0   100 │
│ ETC/USDT:USDT │     12 │         0.72 │          30.936 │         3.09 │         9:55:00 │   11     0     1  91.7 │
│ ETH/USDT:USDT │      8 │         0.66 │          17.864 │         1.79 │ 1 day, 13:55:00 │    7     0     1  87.5 │
│ XLM/USDT:USDT │     10 │         0.31 │          11.054 │         1.11 │        12:08:00 │    9     0     1  90.0 │
│ BTC/USDT:USDT │      8 │         0.21 │           7.289 │         0.73 │ 3 days, 1:24:00 │    6     0     2  75.0 │
│ XRP/USDT:USDT │      9 │        -0.14 │          -7.261 │        -0.73 │        21:18:00 │    8     0     1  88.9 │
│ DOT/USDT:USDT │      6 │         -0.4 │          -9.187 │        -0.92 │         5:35:00 │    4     0     2  66.7 │
│ ADA/USDT:USDT │      8 │        -1.76 │         -52.098 │        -5.21 │        11:38:00 │    6     0     2  75.0 │
│         TOTAL │     77 │         0.22 │          54.774 │         5.48 │        22:12:00 │   67     0    10  87.0 │
└───────────────┴────────┴──────────────┴─────────────────┴──────────────┴─────────────────┴────────────────────────┘
                                               LEFT OPEN TRADES REPORT                                                
┏━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃          Pair ┃ Trades ┃ Avg Profit % ┃ Tot Profit USDT ┃ Tot Profit % ┃     Avg Duration ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ BTC/USDT:USDT │      1 │        -4.14 │          -9.930 │        -0.99 │ 17 days, 8:00:00 │    0     0     1     0 │
│ ETC/USDT:USDT │      1 │        -4.24 │         -15.365 │        -1.54 │         10:40:00 │    0     0     1     0 │
│ DOT/USDT:USDT │      1 │        -5.29 │         -19.125 │        -1.91 │         11:30:00 │    0     0     1     0 │
│         TOTAL │      3 │        -4.56 │         -44.420 │        -4.44 │  6 days, 2:03:00 │    0     0     3     0 │
└───────────────┴────────┴──────────────┴─────────────────┴──────────────┴──────────────────┴────────────────────────┘
                                                ENTER TAG STATS                                                
┏━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Enter Tag ┃ Entries ┃ Avg Profit % ┃ Tot Profit USDT ┃ Tot Profit % ┃ Avg Duration ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│     OTHER │      77 │         0.22 │          54.774 │         5.48 │     22:12:00 │   67     0    10  87.0 │
│     TOTAL │      77 │         0.22 │          54.774 │         5.48 │     22:12:00 │   67     0    10  87.0 │
└───────────┴─────────┴──────────────┴─────────────────┴──────────────┴──────────────┴────────────────────────┘
                                                EXIT REASON STATS                                                 
┏━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Exit Reason ┃ Exits ┃ Avg Profit % ┃ Tot Profit USDT ┃ Tot Profit % ┃    Avg Duration ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│         roi │    67 │         1.05 │         242.179 │        24.22 │        15:49:00 │   67     0     0   100 │
│ exit_signal │     4 │        -2.23 │         -31.217 │        -3.12 │  1 day, 8:38:00 │    0     0     4     0 │
│  force_exit │     3 │        -4.56 │         -44.420 │        -4.44 │ 6 days, 2:03:00 │    0     0     3     0 │
│   stop_loss │     3 │       -10.14 │        -111.768 │       -11.18 │  1 day, 3:05:00 │    0     0     3     0 │
│       TOTAL │    77 │         0.22 │          54.774 │         5.48 │        22:12:00 │   67     0    10  87.0 │
└─────────────┴───────┴──────────────┴─────────────────┴──────────────┴─────────────────┴────────────────────────┘
                                                        MIXED TAG STATS                                                        
┏━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Enter Tag ┃ Exit Reason ┃ Trades ┃ Avg Profit % ┃ Tot Profit USDT ┃ Tot Profit % ┃    Avg Duration ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│           │         roi │     67 │         1.05 │         242.179 │        24.22 │        15:49:00 │   67     0     0   100 │
│           │ exit_signal │      4 │        -2.23 │         -31.217 │        -3.12 │  1 day, 8:38:00 │    0     0     4     0 │
│           │  force_exit │      3 │        -4.56 │         -44.420 │        -4.44 │ 6 days, 2:03:00 │    0     0     3     0 │
│           │   stop_loss │      3 │       -10.14 │        -111.768 │       -11.18 │  1 day, 3:05:00 │    0     0     3     0 │
│     TOTAL │             │     77 │         0.22 │          54.774 │         5.48 │        22:12:00 │   67     0    10  87.0 │
└───────────┴─────────────┴────────┴──────────────┴─────────────────┴──────────────┴─────────────────┴────────────────────────┘
                          SUMMARY METRICS                          
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Metric                        ┃ Value                           ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ Backtesting from              │ 2025-07-01 00:00:00             │
│ Backtesting to                │ 2025-08-01 00:00:00             │
│ Trading Mode                  │ Isolated Futures                │
│ Max open trades               │ 3                               │
│                               │                                 │
│ Total/Daily Avg Trades        │ 77 / 2.48                       │
│ Starting balance              │ 1000 USDT                       │
│ Final balance                 │ 1054.774 USDT                   │
│ Absolute profit               │ 54.774 USDT                     │
│ Total profit %                │ 5.48%                           │
│ CAGR %                        │ 87.36%                          │
│ Sortino                       │ 2.48                            │
│ Sharpe                        │ 3.75                            │
│ Calmar                        │ 40.99                           │
│ SQN                           │ 0.69                            │
│ Profit factor                 │ 1.29                            │
│ Expectancy (Ratio)            │ 0.71 (0.04)                     │
│ Avg. daily profit             │ 1.767 USDT                      │
│ Avg. stake amount             │ 345.016 USDT                    │
│ Total trade volume            │ 53316.954 USDT                  │
│                               │                                 │
│ Long / Short trades           │ 67 / 10                         │
│ Long / Short profit %         │ 8.94% / -3.47%                  │
│ Long / Short profit USDT      │ 89.425 / -34.651                │
│                               │                                 │
│ Best Pair                     │ LTC/USDT:USDT 5.62%             │
│ Worst Pair                    │ ADA/USDT:USDT -5.21%            │
│ Best trade                    │ ETC/USDT:USDT 2.00%             │
│ Worst trade                   │ ADA/USDT:USDT -10.17%           │
│ Best day                      │ 26.91 USDT                      │
│ Worst day                     │ -47.741 USDT                    │
│ Days win/draw/lose            │ 20 / 6 / 5                      │
│ Min/Max/Avg. Duration Winners │ 0d 00:35 / 5d 18:15 / 0d 15:49  │
│ Min/Max/Avg. Duration Losers  │ 0d 10:40 / 17d 08:00 / 2d 17:00 │
│ Max Consecutive Wins / Loss   │ 36 / 3                          │
│ Rejected Entry signals        │ 258                             │
│ Entry/Exit Timeouts           │ 0 / 0                           │
│                               │                                 │
│ Min balance                   │ 1003.168 USDT                   │
│ Max balance                   │ 1149.421 USDT                   │
│ Max % of account underwater   │ 8.23%                           │
│ Absolute drawdown             │ 94.647 USDT (8.23%)             │
│ Drawdown duration             │ 9 days 08:50:00                 │
│ Profit at drawdown start      │ 149.421 USDT                    │
│ Profit at drawdown end        │ 54.774 USDT                     │
│ Drawdown start                │ 2025-07-22 15:10:00             │
│ Drawdown end                  │ 2025-08-01 00:00:00             │
│ Market change                 │ 30.51%                          │
└───────────────────────────────┴─────────────────────────────────┘

Backtested 2025-07-01 00:00:00 -> 2025-08-01 00:00:00 | Max open trades : 3
                                                            STRATEGY SUMMARY                                                            
┏━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃       Strategy ┃ Trades ┃ Avg Profit % ┃ Tot Profit USDT ┃ Tot Profit % ┃ Avg Duration ┃  Win  Draw  Loss  Win% ┃           Drawdown ┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ SampleStrategy │     77 │         0.22 │          54.774 │         5.48 │     22:12:00 │   67     0    10  87.0 │ 94.647 USDT  8.23% │
└────────────────┴────────┴──────────────┴─────────────────┴──────────────┴──────────────┴────────────────────────┴────────────────────┘
```
### バックテストレポート表

最初のテーブルには、「放置されたオープン取引」を含む、ボットが行ったすべての取引が含まれています。

最後の行は戦略の全体的なパフォーマンスを示します。
ここで：
```
│         TOTAL │     77 │         0.22 │          54.774 │         5.48 │        22:12:00 │   67     0    10  87.0 │
```
このボットは、平均継続時間「22:12:00」で「77」の取引を行い、パフォーマンス「5.48%」(利益)を達成しました。これは、資本金 1,000 USDT から合計「54.774 USDT」を獲得したことを意味します。

「平均利益 %」列には、行われたすべての取引の平均利益が表示されます。
「合計利益 %」列には、開始残高に対する合計利益 % が表示されます。

上記の結果では、開始残高が 1000 USDT、絶対利益が 54.774 USDT であるため、「総利益 %」は「(54.774 / 1000) * 100 ~= 5.48%」となります。

戦略のパフォーマンスは、エントリー戦略、エグジット戦略に加え、設定した「minimal_roi」と「stop_loss」にも影響されます。

たとえば、`minimal_roi` が `"0": 0.01` のみの場合、ボットが 1% を超える利益を上げることは期待できません (取引が 1% に達するたびにボットは終了するため)。
```json
"minimal_roi": {
    "0":  0.01
},
```
逆に、「minimal_roi」を「0」のように大きくしすぎると、0.55となります。
(55%)、ボットがこの利益に達する可能性はほとんどありません。
したがって、パフォーマンスは、戦略、設定、設定した暗号通貨ペアのさまざまな要素がすべて統合されたものであることに留意してください。

### 開いたままの取引テーブル

2 番目の表には、全体像を示すためにバックテスト期間の終了時にボットが「force_exit」する必要があったすべての取引が含まれています。
バックテスト期間はある時点で終了する必要がある一方で、現実的にはボットを永久に実行し続けることもできるため、これは現実的な動作をシミュレートするために必要です。
これらの取引は最初の表にも含まれていますが、わかりやすくするためにこの表でも個別に示しています。

### タグ統計テーブルを入力してください

3 番目の表は、エントリー タグ (例: 「enter_long」、「enter_short」) ごとに取引の内訳を示し、エントリー数、平均利益率、ステーク通貨での合計利益、合計利益率、平均期間、各タグの勝ち数、引き分け数、負け数を示しています。

### 終了理由の統計表

4 番目の表には、終了理由の要約が含まれています (例: `exit_signal`、`roi`、`stop_loss`、`force_exit`)。この表は、どの領域に追加の作業が必要かを示します (たとえば、多くの「exit_signal」取引が損失である場合は、exit シグナルの改善に取り組むか、無効にすることを検討する必要があります)。

### 混合タグ統計表

5 番目の表は、エントリ タグと終了理由を組み合わせたもので、さまざまなエントリ タグが特定の終了理由でどのように実行されたかを詳細に示しています。これは、参入戦略と撤退戦略のどの組み合わせが最も効果的かを特定するのに役立ちます。

### 概要メトリクス

バックテスト レポートの最後の要素は、概要メトリック テーブルです。
これには、バックテスト データに対する戦略のパフォーマンスに関する重要な指標が含まれています。
```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Metric                        ┃ Value                           ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ Backtesting from              │ 2025-07-01 00:00:00             │
│ Backtesting to                │ 2025-08-01 00:00:00             │
│ Trading Mode                  │ Isolated Futures                │
│ Max open trades               │ 3                               │
│                               │                                 │
│ Total/Daily Avg Trades        │ 72 / 2.32                       │
│ Starting balance              │ 1000 USDT                       │
│ Final balance                 │ 1106.734 USDT                   │
│ Absolute profit               │ 106.734 USDT                    │
│ Total profit %                │ 10.67%                          │
│ CAGR %                        │ 230.04%                         │
│ Sortino                       │ 4.99                            │
│ Sharpe                        │ 8.00                            │
│ Calmar                        │ 77.76                           │
│ SQN                           │ 1.52                            │
│ Profit factor                 │ 1.79                            │
│ Expectancy (Ratio)            │ 1.48 (0.07)                     │
│ Avg. daily profit             │ 3.443 USDT                      │
│ Avg. stake amount             │ 363.133 USDT                    │
│ Total trade volume            │ 52466.174 USDT                  │
│                               │                                 │
│ Best Pair                     │ LTC/USDT:USDT 4.48%             │
│ Worst Pair                    │ ADA/USDT:USDT -1.78%            │
│ Best trade                    │ ETC/USDT:USDT 2.00%             │
│ Worst trade                   │ ADA/USDT:USDT -10.17%           │
│ Best day                      │ 23.535 USDT                     │
│ Worst day                     │ -49.813 USDT                    │
│ Days win/draw/lose            │ 21 / 6 / 4                      │
│ Min/Max/Avg. Duration Winners │ 0d 00:35 / 5d 18:15 / 0d 15:30  │
│ Min/Max/Avg. Duration Losers  │ 0d 12:00 / 17d 08:00 / 3d 23:28 │
│ Max Consecutive Wins / Loss   │ 58 / 4                          │
│ Rejected Entry signals        │ 254                             │
│ Entry/Exit Timeouts           │ 0 / 0                           │
│                               │                                 │
│ Min balance                   │ 1003.168 USDT                   │
│ Max balance                   │ 1209 USDT                       │
│ Max % of account underwater   │ 8.46%                           │
│ Absolute drawdown             │ 102.266 USDT (8.46%)            │
│ Drawdown duration             │ 9 days 08:50:00                 │
│ Profit at drawdown start      │ 209 USDT                        │
│ Profit at drawdown end        │ 106.734 USDT                    │
│ Drawdown start                │ 2025-07-22 15:10:00             │
│ Drawdown end                  │ 2025-08-01 00:00:00             │
│ Market change                 │ 30.51%                          │
└───────────────────────────────┴─────────────────────────────────┘
```
- `バックテスト開始` / `バックテスト終了`: バックテスト範囲 (通常は `--timerange` オプションで定義されます)。
- 「取引モード」: 現物取引または先物取引。
- `Max open trades`: `max_open_trades` (または `--max-open-trades`) の設定 - またはペアリスト内のペアの数 (いずれか小さい方)。
- 「合計/日次平均取引数」: バックテスト出力テーブルの合計取引数 / 合計取引数をバックテスト期間 (日数) で割ったものと同じです (これにより、戦略から予想される取引数に関する情報が得られます)。
- 「開始残高」: 開始残高 - dry-run-wallet (構成またはコマンドライン) によって指定されます。
- 「最終残高」: 最終残高 - 開始残高 + 絶対利益。
- 「絶対利益」: ステーク通貨で得られる利益。
- `総利益 %`: 総利益。最初のテーブルの「TOTAL」行の「Tot Profit %」に合わせて配置されます。 「(終了資本 − 開始資本) / 開始資本」として計算されます。
- `CAGR %`: 複合年間成長率。
- `Sortino`: ソルティーノの年率。
- `Sharpe`: 年換算のシャープレシオ。
- `Calmar`: 年率換算の Calmar 比率。
- 「SQN」: システム品質番号 (SQN) - Van Tharp 著。
- 「利益係数」: すべての勝ち取引の利益の合計を、すべての負け取引の損失の合計で割ったもの。
- 「期待値 (比率)」: 取引ごとの平均利益または損失である期待率。マイナスの期待率は、戦略が利益を生まないことを意味します。
- 「平均」日次利益`: 1 日あたりの平均利益。「(総利益 / バックテスト日数)」として計算されます。
- 「平均」 stake amount`: 平均ステーク量。`stake_amount` または動的ステーク量を使用する場合の平均。
- 「総取引量」: 上記の利益を達成するために取引所で生成される取引量。
- 「ロング/ショート取引」: ロング/ショート取引回数を分割します(ショート取引が行われた場合のみ表示されます)。
- `ロング/ショート利益 %`: ロングおよびショート取引の利益のパーセンテージ (ショート取引が行われた場合のみ表示されます)。
- 「ロング/ショート利益 USDT」: ロングおよびショート取引のステーク通貨での利益 (ショート取引が行われた場合のみ表示)。
- 「最良のペア」/「最悪のペア」: (総利益率に基づく) 最もパフォーマンスの高いペアと最も悪いペア、およびそれに対応する「総利益 %」。
- 「最良のトレード」/「最悪のトレード」: 単一の最大の勝利トレードと最大の単一の損失トレード。
- `最良の日` / `最悪の日`: 1 日の利益に基づいて最良の日と最悪の日。
- 「勝ち/引き分け/負けの日」: 勝ち/負けの日 (引き分けは通常、取引が終了していない日です)。
- `最小/最大/平均期間勝者`: 勝ちトレードの最小、最大、平均期間。
- `最小/最大/平均期間敗者`: 損失取引の最小、最大、および平均期間。
- `最大連続勝利数/最大連続敗北数`: 連続した最大連続勝利数/連続敗北数。
- 「拒否されたエントリーシグナル」: 「max_open_trades」に達したために実行できなかったトレードエントリーシグナル。
- 「エントリー/エグジットタイムアウト」: 約定しなかったエントリー/エグジット注文 (カスタム価格設定が使用されている場合にのみ適用されます)。
- 「最小残高」 / 「最大残高」: バックテスト期間中のウォレット残高の最低値と最高値。
- 「水中のアカウントの最大 %」: シミュレーション開始以来、アカウントがトップから減少した最大パーセンテージ。 「(最大残高 - 現在の残高) / (最大残高)」の最大値として計算されます。
- 「絶対ドローダウン」: 「(絶対ドローダウン) / (ドローダウン高 + 開始残高)」として計算されるアカウントに対する割合を含む、経験した最大絶対ドローダウン。
- 「ドローダウン期間」: 最大ドローダウン期間の期間。
- 「ドローダウン開始時の利益」 / 「ドローダウン終了時の利益」: 最大ドローダウン期間の開始時と終了時の利益。
- `ドローダウン開始` / `ドローダウン終了`: 最大ドローダウンの開始日時と終了日時 (`plot-dataframe` サブコマンドを使用して視覚化することもできます)。
- 「市場変化」: バックテスト期間中の市場の変化。 「終値」列を使用して、最初のローソク足から最後のローソク足までのすべてのペアの変化の平均として計算されます。

### 日次 / 週次 / 月次 / 年次の内訳

「--breakdown <>」スイッチを使用すると、日次、週次、月次、または年次の結果の概要を取得できます。

月次および年次の内訳を視覚化するには、次を使用できます。
``` bash
freqtrade backtesting --strategy MyAwesomeStrategy --breakdown month year
```

``` output
                                 MONTH BREAKDOWN
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃      Month ┃ Trades ┃ Tot Profit USDT ┃ Profit Factor ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 31/01/2020 │     12 │          44.451 │          7.28 │   10     0     2  83.3 │
│ 29/02/2020 │     30 │           45.41 │          2.36 │   17     0    13  56.7 │
│ 31/03/2020 │     35 │         142.024 │          2.42 │   14     0    21  40.0 │
│ 30/04/2020 │     67 │         -23.692 │          0.81 │   24     0    43  35.8 │
...
...
│ 30/04/2025 │    203 │          -63.43 │          0.81 │   73     0   130  36.0 │
│ 31/05/2025 │    142 │         104.675 │          1.28 │   59     0    83  41.5 │
│ 30/06/2025 │    177 │          -1.014 │           1.0 │   85     0    92  48.0 │
│ 31/07/2025 │    155 │         232.762 │           1.6 │   63     0    92  40.6 │
└────────────┴────────┴─────────────────┴───────────────┴────────────────────────┘
                                  YEAR BREAKDOWN
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃       Year ┃ Trades ┃ Tot Profit USDT ┃ Profit Factor ┃  Win  Draw  Loss  Win% ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 31/12/2020 │    896 │         868.889 │          1.46 │  351     0   545  39.2 │
│ 31/12/2021 │   1778 │        4487.163 │          1.93 │  745     0  1033  41.9 │
│ 31/12/2022 │   1736 │          938.27 │          1.27 │  698     0  1038  40.2 │
│ 31/12/2023 │   1712 │        1677.126 │          1.68 │  670     0  1042  39.1 │
│ 31/12/2024 │   1609 │        3198.424 │          2.22 │  773     0   836  48.0 │
│ 31/12/2025 │   1042 │         716.174 │          1.33 │  420     0   622  40.3 │
└────────────┴────────┴─────────────────┴───────────────┴────────────────────────┘
```
出力には、選択した期間に実現された絶対利益 (ステーク通貨) を含む表が、取引数、プロフィットファクター、この期間に実現した (クローズされた) 勝ち、引き分け、損失の分布などの追加統計とともに表示されます。

### バックテスト結果のキャッシュ

時間を節約するために、バックテストの戦略と構成が以前のバックテストのものと一致する場合、デフォルトではバックテストは、過去 1 日以内にキャッシュされた結果を再利用します。同一の実行に対する既存の結果にもかかわらず新しいバックテストを強制するには、「--cache none」パラメータを指定します。

!!!警告
    freqtrade では基になるデータが変更されていないことを確実に保証できないため、無制限の時間範囲 (`--timerange 20210101-`) ではキャッシュが自動的に無効になります。また、元のバックテストの最後にデータが欠落していた場合、キャッシュされた結果を使用すべきでない場所で使用することもできますが、これはさらにデータをダウンロードすることで修正されました。
    この場合、「--cache none」を 1 回使用して、新しいバックテストを強制してください。

### バックテスト結果のさらなる分析

バックテスト結果をさらに分析するために、freqtrade はデフォルトで取引をファイルにエクスポートします。
その後、取引をロードして、[データ分析](strategy_analysis_example.md#load-backtest-results-to-pandas-dataframe) バックテスト セクションに示すように、さらなる分析を実行できます。

また、freqtrade を [Web サーバー モード](freq-ui.md#backtesting) で使用して、Web インターフェイスでバックテスト結果を視覚化することもできます。
このモードでは、既存のバックテスト結果を読み込むこともできるため、バックテストを再度実行することなく分析できます。  
このモードの場合 - `--notes "<notes>"` を使用してバックテスト結果にメモを追加でき、Web インターフェイスに表示されます。

### バックテスト出力ファイル

freqtrade が生成する出力ファイルは、次のファイルを含む zip ファイルです。

- JSON形式のバックテストレポート
- フェザー形式の市場変動データ
- 戦略ファイルのコピー
- 戦略パラメーターのコピー (パラメーター ファイルが使用された場合)
- 設定ファイルのサニタイズされたコピー

これにより、同じデータが利用できるという前提の下で、結果の再現性が保証されます。

zip ファイルには戦略ファイルと構成ファイルのみが含まれており、最終的な依存関係は含まれません。

## バックテストによる仮定

バックテストにはローソク足内で何が起こるかについての詳細な情報が欠けているため、いくつかの仮定を置く必要があります。

- 取引所の[取引制限](#trading-limits-in-backtesting)が尊重されます
- カスタム価格ロジックが指定されていない限り、エントリーはオープン価格で行われます
- 価格がローソク足の高値/安値の範囲内にある限り、すべての注文は要求された価格で約定されます（スリッページなし）。
- 終了シグナルの終了は、連続するローソク足の始値で発生します。
- エグジットは、別のペアとの新しい取引のために取引スロットを解放します
- エグジットシグナルはローソク足のオープン時にトリガーされると想定されているため、ストップロスよりもエグジットシグナルが優先されます。
- ROI
  - 出口は高と比較されますが、ROI 値が使用されます (例: ROI = 2%、高 = 5% - したがって出口は 2% になります)
  - エグジットが「ローソク足を下回る」ことは決してないため、ROI が 2% の場合、利益が 2.4% であった場合、エグジットは 2.4% になる可能性があります。
  - トリガーとなるローソク足で有効になった ROI エントリ (例: 1 時間足ローソク足の「120: 0.02」、「60: 0.05」から) は、ローソク足の始値をエグジット レートとして使用します。
  - `<N>=-1` ROI エントリによって引き起こされる強制終了は、N がローソク足のオープンに該当しない限り、終了値として Low を使用します (例: 1h ローソク足の場合は `120: -1`)
- ストップロスのエグジットは、たとえ安値が低かったとしても、ストップロス価格で正確に行われますが、損失はストップロス価格よりも「2 * 手数料」高くなります。
- ストップロスは、1 つのキャンドル内の ROI の前に評価されます。そのため、ドライラン/ライブトレードモードで同じ戦略で得られた結果と比較して、「ストップロス」終了理由を持つより多くの取引が見られることがよくあります。
- ストップロスの高値の前に安値が発生し、最初に資本を保護します
- トレーリングストップロス
  - トレーリングストップロスはローソク足の安値を下回っている場合にのみ調整されます（そうでない場合はトリガーされます）
  - トレーリングストップロスをトリガーするトレードエントリーキャンドルでは、「最小オフセット」(`stop_positive_offset`) が (高値ではなく) 想定され、ストップはこの時点から計算されます。利用可能なストップロス ロジックに関する情報がないため、このルールはカスタム ストップロス シナリオには適用されません。
  - ハイが最初に発生します - ストップロスを調整します
  - Low は調整されたストップロスを使用します (そのため、高値と安値の差が大きい出口は正しくバックテストされます)
  - ROIはトレーリングストップの前に適用され、ROIとトレーリングストップの両方が適用される場合、利益はROIで「上限に達する」ことが保証されます。
- Exit-reason では、取引がプラスだったのかマイナスだったのかは説明されず、何がエグジットのきっかけとなったのかだけが説明されています (負の ROI 値が使用されている場合、これは奇妙に見える可能性があります)
- 評価シーケンス (同じローソク足で複数のシグナルが発生した場合)
  - 出口信号
  - ストップロス
  - ROI
  - トレーリングストップロス
- ポジションの反転（先物のみ）は、既存の取引が終了するローソク足で終了取引とは別の方向のエントリーシグナルがトリガーされた場合に発生します。

これらの仮定に基づいて、バックテストは実際の取引を可能な限り忠実に反映しようとします。ただし、バックテストがドライラン モードでの戦略の実行に代わることは**決して**ありません。
また、過去の結果が将来の成功を保証するものではないことにも留意してください。

上記の前提に加えて、戦略作成者は、実際の市場状況では利用できないデータをバックテストで使用することを避けるために、[よくある間違い](strategy-customization.md#common-mistakes-when-developing-strategies) セクションを注意深く読む必要があります。

### バックテストにおける取引制限
取引所には、最小（および最大）基本通貨や最小/最大ステーク（相場）通貨など、特定の取引制限があります。
これらの制限は通常、「取引ルール」または同様のものとして取引所の文書に記載されており、異なるペア間では大きく異なる場合があります。

バックテスト (およびライブおよびドライラン) ではこれらの制限が尊重され、ストップロスをこの値よりも下に設定できることが保証されます。そのため、値は取引所が指定するものよりわずかに高くなります。
ただし、Freqtrade は過去の制限に関する情報を持っていません。

これにより、過去の価格を使用して取引制限が膨らみ、最低金額が 50\$ を超える状況が発生する可能性があります。

たとえば:

BTCの最低取引可能量は0.001です。
BTC は今日 22.000\$ で取引されています (0.001 BTC がこれに関連しています) - しかし、バックテスト期間には 50.000\$ もの高価格が含まれています。
今日の最小値は `0.001 * 22_000`、つまり 22\$ になります。  
ただし、過去の設定では `0.001 * 50_000` に基づいて、制限が 50$ になることもあります。

#### 取引精度の制限

ほとんどの取引所では価格と金額の両方に精度制限があるため、ペアの 1.0020401 を購入したり、価格 1.24567123123 で購入したりすることはできません。  
代わりに、これらの価格と金額は、定義された取引精度に合わせて (取引所の定義に基づいて) 四捨五入または切り捨てられます。
上記の値は、たとえば、金額 1.002、価格 1.24567 に丸められます。

過去の精度制限は利用できないため、これらの精度値は現在の為替制限に基づいています ([上記のセクション](#trading-limits-in-backtesting) で説明されているように)。

## バックテストの精度の向上

バックテストの大きな制限の 1 つは、価格がローソク足内でどのように推移したか (取引終了前に高かったのか、それともその逆か) を知ることができないことです。
したがって、1 時間の時間枠でバックテストを実行すると仮定すると、そのローソク足には 4 つの価格 (始値、高値、安値、終値) が存在します。

バックテストではこれについていくつかの前提条件が必要ですが (上記をお読みください)、これは決して完璧ではなく、常に何らかの形でバイアスがかかります。
これを軽減するために、freqtrade はより低い (より速い) タイムフレームを使用してローソク足内の動きをシミュレートできます。

これを利用するには、通常のバックテスト コマンドに「--timeframe-detail 5m」を追加します。
``` bash
freqtrade backtesting --strategy AwesomeStrategy --timeframe 1h --timeframe-detail 5m
```
これにより、選択した時間範囲の 1 時間のデータ (メインの時間枠) と 5 分のデータ (詳細な時間枠) がロードされます。
戦略は 1 時間の時間枠で分析されます。
アクティビティが発生する可能性がある (アクティブなシグナルがあり、ペアが取引中である) ローソク足は 5 メートルのタイムフレームで評価されます。
これにより、キャンドル内の動きをより正確にシミュレーションできるようになり、特に長い時間枠では異なる結果が生じる可能性があります。

通常、エントリーはメインローソク足の始値で発生しますが、解放された取引スロットは（5m ローソク足で出口シグナルがトリガーされた場合）より早く解放される可能性があり、その後、別のペアの新しい取引に使用できます。

すべてのコールバック関数 (`custom_exit()`、`custom_stoploss()` など) は、取引が開始されると 5 メートルのローソク足ごとに実行されます (つまり、上記の 1 時間のタイムフレームと 5 メートルの詳細なタイムフレームの例では 12 回実行されます)。

`--timeframe-detail` は元のタイムフレームより小さくする必要があります。そうでないとバックテストの開始に失敗します。

明らかに、これにはより多くのメモリが必要になり (500 万のデータは 1 時間のデータより大きい)、実行時間にも影響します (取引量と取引期間に応じて)。
また、データはすでに利用可能またはダウンロードされている必要があります。

!!!ヒント
    この関数を戦略開発の最後の部分として使用して、戦略が [バックテストの仮定](#assumptions-made-by-backtesting) のいずれかを悪用していないことを確認できます。このモードで同様に良好なパフォーマンスを示す戦略は、ドライ/ライブ モードでも良好なパフォーマンスを発揮する可能性が高くなります (ただし、戦略を実際に確認できるのはフォワード テスト (ドライ モード) のみです)。

???サンプル「極端な違いの例」
    極端な例で `--timeframe-detail` を使用すると (以下のすべてのペアにエントリーシグナルのある 10:00 のローソク足がある)、1 max_open_trades で次のバックテスト取引シーケンスが発生する可能性があります。

    |ペア |入場時間 |終了時間 |期間 |
    |------|-----------|----------| -------- |
    | BTC/USDT | 2024-01-01 10:00:00 | 2021-01-01 10:05:00 | 5m |
    | ETH/USDT | 2024-01-01 10:05:00 | 2021-01-01 10:15:00 | 10メートル |
    | XRP/USDT | 2024-01-01 10:15:00 | 2021-01-01 10:30:00 | 15メートル |
    |ソル/USDT | 2024-01-01 10:15:00 | 2021-01-01 11:05:00 | 50メートル |
    | BTC/USDT | 2024-01-01 11:05:00 | 2021-01-01 12:00:00 | 55メートル |

    timeframe-detail がない場合、これは次のようになります。

    |ペア |入場時間 |終了時間 |期間 |
    |------|-----------|----------| -------- |
    | BTC/USDT | 2024-01-01 10:00:00 | 2021-01-01 11:00:00 | 1時間 |
    | BTC/USDT | 2024-01-01 11:00:00 | 2021-01-01 12:00:00 | 1時間 |

    詳細データがない場合、ローソクごとの最初の「max_open_trades」シグナルのみが評価され、取引スロットはローソクの終わりにのみ解放され、次のローソクで新しい取引を開始できるため、この違いは重要です。


## 複数の戦略のバックテスト
複数の戦略を比較するために、バックテストに戦略のリストを提供できます。

これは、実行ごとに 1 つのタイムフレーム値に制限されます。ただし、データはディスクから 1 回しかロードされないため、複数のデータがある場合は、
比較したい戦略を選択すると、実行時間が大幅に向上します。

`--recursive-strategy-search` も指定されていない限り、リストされたすべての Strategy は同じディレクトリに存在する必要があります。この場合、Strategy ディレクトリ内のサブディレクトリも考慮されます。
``` bash
freqtrade backtesting --timerange 20180401-20180410 --timeframe 5m --strategy-list Strategy001 Strategy002 --export trades
```
これにより、「Strategy001」と「Strategy002」の両方の結果を含む結果が「user_data/backtest_results/backtest-result-<datetime>.json」に保存されます。
さまざまな戦略の勝敗を比較する追加の表があります (最初の表の「合計」行と同じ)。
すべての戦略の詳細な出力が次々と表示されるため、必ず上にスクロールして戦略ごとの詳細を確認してください。
```
================================================== STRATEGY SUMMARY ===================================================================
| Strategy    |  Trades |   Avg Profit % |   Tot Profit BTC |   Tot Profit % | Avg Duration   |  Wins |  Draws | Losses | Drawdown % |
|-------------+---------+----------------+------------------+----------------+----------------+-------+--------+--------+------------|
| Strategy1   |     429 |           0.36 |       0.00762792 |          76.20 | 4:12:00        |   186 |      0 |    243 |       45.2 |
| Strategy2   |    1487 |          -0.13 |      -0.00988917 |         -98.79 | 4:43:00        |   662 |      0 |    825 |     241.68 |
```
## 次のステップ

なるほど、あなたの戦略は有益です。ボットが戦略に使用する最適なパラメーターを提供できるとしたらどうなるでしょうか?
次のステップは、[Hyperopt で最適なパラメーターを見つける方法](hyperopt.md) を学習することです。
