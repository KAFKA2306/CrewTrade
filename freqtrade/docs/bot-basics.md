# Freqtradeの基本

このページでは、Freqtradeがどのように機能し、動作するかについての基本的な概念を提供します。

## Freqtrade用語

* **Strategy（戦略）**: あなたのトレーディング戦略で、ボットに何をすべきかを指示します。
* **Trade（トレード）**: オープンポジション。
* **Open Order（オープンオーダー）**: 現在取引所に発注されているが、まだ完了していない注文。
* **Pair（ペア）**: トレード可能なペアで、通常Base/Quoteの形式（例：スポットの場合は`XRP/USDT`、先物の場合は`XRP/USDT:USDT`）。
* **Timeframe（時間枠）**: 使用するローソク足の長さ（例：`"5m"`、`"1h"`、...）。
* **Indicators（インジケーター）**: テクニカル指標（SMA、EMA、RSI、...）。
* **Limit order（指値注文）**: 定義された指値価格またはそれ以上で実行される指値注文。
* **Market order（成行注文）**: 確実に約定されるが、注文サイズに応じて価格が動く可能性がある。
* **Current Profit（現在の利益）**: このトレードの現在保留中（未実現）の利益。これは主にボットとUI全体で使用されます。
* **Realized Profit（実現利益）**: すでに実現された利益。[部分的な出口](strategy-callbacks.md#adjust-trade-position)と組み合わせた場合にのみ関連します - これはこの計算ロジックも説明しています。
* **Total Profit（合計利益）**: 実現利益と未実現利益の合計。相対数（%）は、このトレードの総投資額に対して計算されます。

## 手数料の処理

Freqtradeのすべての利益計算には手数料が含まれます。バックテスト / Hyperopt / ドライランモードでは、取引所のデフォルト手数料が使用されます（取引所の最低ティア）。ライブ操作では、取引所によって適用される手数料が使用されます（これにはBNBリベートなどが含まれます）。

## ペアの命名

Freqtradeは通貨の[ccxt命名規則](https://docs.ccxt.com/#/README?id=consistency-of-base-and-quote-currencies)に従います。
間違った市場で間違った命名規則を使用すると、通常、ボットがペアを認識できず、「このペアは利用できません」などのエラーが発生します。

### スポットペアの命名

スポットペアの場合、命名は`base/quote`になります（例：`ETH/USDT`）。

### 先物ペアの命名

先物ペアの場合、命名は`base/quote:settle`になります（例：`ETH/USDT:USDT`）。

## ボット実行ロジック
ドライランまたはライブモードでfreqtradeを起動すると（`freqtrade trade`を使用）、ボットが起動し、ボットイテレーションループが開始されます。
これにより、`bot_start()`コールバックも実行されます。

デフォルトでは、ボットループは数秒ごと（`internals.process_throttle_secs`）に実行され、以下のアクションを実行します：

* 永続性からオープントレードを取得します。
* 現在のトレード可能なペアのリストを計算します。
* すべての[情報ペア](strategy-customization.md#get-data-for-non-tradeable-pairs)を含むペアリストのOHLCVデータをダウンロードします
  このステップは、不要なネットワークトラフィックを回避するために、ローソク足ごとに1回だけ実行されます。
* `bot_loop_start()`戦略コールバックを呼び出します。
* ペアごとに戦略を分析します。
  * `populate_indicators()`を呼び出します
  * `populate_entry_trend()`を呼び出します
  * `populate_exit_trend()`を呼び出します
* 取引所からトレードのオープンオーダー状態を更新します。
  * 約定した注文に対して`order_filled()`戦略コールバックを呼び出します。
  * オープンオーダーのタイムアウトをチェックします。
    * オープンエントリー注文に対して`check_entry_timeout()`戦略コールバックを呼び出します。
    * オープンイグジット注文に対して`check_exit_timeout()`戦略コールバックを呼び出します。
    * オープンオーダーに対して`adjust_order_price()`戦略コールバックを呼び出します。
      * オープンエントリー注文に対して`adjust_entry_price()`戦略コールバックを呼び出します。*`adjust_order_price()`が実装されていない場合のみ呼び出されます*
      * オープンイグジット注文に対して`adjust_exit_price()`戦略コールバックを呼び出します。*`adjust_order_price()`が実装されていない場合のみ呼び出されます*
* 既存のポジションを検証し、最終的に出口注文を発注します。
  * ストップロス、ROI、出口シグナル、`custom_exit()`、`custom_stoploss()`を考慮します。
  * `exit_pricing`設定または`custom_exit_price()`コールバックを使用して出口価格を決定します。
  * 出口注文が発注される前に、`confirm_trade_exit()`戦略コールバックが呼び出されます。
* 有効な場合、`adjust_trade_position()`を呼び出してオープントレードのポジション調整をチェックし、必要に応じて追加注文を発注します。
* トレードスロットがまだ利用可能かどうかをチェックします（`max_open_trades`に達した場合）。
* エントリーシグナルを検証して新しいポジションに入ろうとします。
  * `entry_pricing`設定または`custom_entry_price()`コールバックを使用してエントリー価格を決定します。
  * マージンおよび先物モードでは、`leverage()`戦略コールバックが呼び出されて、希望するレバレッジが決定されます。
  * `custom_stake_amount()`コールバックを呼び出してステークサイズを決定します。
  * エントリー注文が発注される前に、`confirm_trade_entry()`戦略コールバックが呼び出されます。

このループは、ボットが停止されるまで何度も繰り返されます。

## バックテスト / Hyperopt実行ロジック

[backtesting](backtesting.md)または[hyperopt](hyperopt.md)は、ほとんどのトレーディング操作が完全にシミュレートされるため、上記のロジックの一部のみを実行します。

* 設定されたペアリストの履歴データを読み込みます。
* `bot_start()`を1回呼び出します。
* インジケーターを計算します（ペアごとに`populate_indicators()`を1回呼び出します）。
* エントリー / 出口シグナルを計算します（ペアごとに`populate_entry_trend()`と`populate_exit_trend()`を1回呼び出します）。
* エントリーと出口ポイントをシミュレートして、ローソク足ごとにループします。
  * `bot_loop_start()`戦略コールバックを呼び出します。
  * `unfilledtimeout`設定、または`check_entry_timeout()` / `check_exit_timeout()`戦略コールバックを介してオーダータイムアウトをチェックします。
  * オープンオーダーに対して`adjust_order_price()`戦略コールバックを呼び出します。
    * オープンエントリー注文に対して`adjust_entry_price()`戦略コールバックを呼び出します。*`adjust_order_price()`が実装されていない場合のみ呼び出されます！*
    * オープンイグジット注文に対して`adjust_exit_price()`戦略コールバックを呼び出します。*`adjust_order_price()`が実装されていない場合のみ呼び出されます！*
  * トレードエントリーシグナル（`enter_long` / `enter_short`列）をチェックします。
  * トレードエントリー / 出口を確認します（戦略に実装されている場合、`confirm_trade_entry()`と`confirm_trade_exit()`を呼び出します）。
* エントリー価格を決定するために`custom_entry_price()`を呼び出します（戦略に実装されている場合）（価格は開始ローソク足内に移動されます）。
  * マージンおよび先物モードでは、`leverage()`戦略コールバックが呼び出されて、希望するレバレッジが決定されます。
  * `custom_stake_amount()`コールバックを呼び出してステークサイズを決定します。
  * 有効な場合、オープントレードのポジション調整をチェックし、`adjust_trade_position()`を呼び出して追加注文が要求されているかどうかを判断します。
  * 約定したエントリー注文に対して`order_filled()`戦略コールバックを呼び出します。
  * カスタム出口ポイントを見つけるために`custom_stoploss()`と`custom_exit()`を呼び出します。
  * 出口シグナル、カスタム出口、部分的な出口に基づく出口の場合：出口価格を決定するために`custom_exit_price()`を呼び出します（価格は閉鎖ローソク足内に移動されます）。
  * 約定した出口注文に対して`order_filled()`戦略コールバックを呼び出します。
* バックテストレポート出力を生成します

!!! Note
    バックテストとHyperoptの両方は、計算に取引所のデフォルト手数料を含みます。カスタム手数料は、`--fee`引数を指定することにより、バックテスト / hyperoptに渡すことができます。

!!! Warning "コールバック呼び出し頻度"
    バックテストは、各コールバックをローソク足ごとに最大1回呼び出します（`--timeframe-detail`はこの動作を詳細なローソク足ごとに1回に変更します）。
    ほとんどのコールバックは、ライブでは反復ごとに1回呼び出されます（通常は約5秒ごと） - これによりバックテストの不一致が発生する可能性があります。
